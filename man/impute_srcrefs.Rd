% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/impute_srcrefs.R
\name{impute_srcrefs}
\alias{impute_srcrefs}
\title{Impute srcrefs for missing control-flow braces in a function AST.}
\usage{
impute_srcrefs(fn)
}
\arguments{
\item{fn}{A function.}
}
\value{
A function with transformed body/formals and preserved function-level
attributes (including srcref/srcfile metadata when present).
}
\description{
Traverses a function's AST and wraps unbraced expressions in control-flow
positions with \code{{ ... }} while attaching transparent srcrefs to the injected
brace calls. The srcref assigned to an injected brace matches the span of the
wrapped expression so that source mapping stays aligned with original code.
}
\details{
Covered constructs include:
\itemize{
\item \code{if} / \verb{else}
\item \code{for}, \code{while}, \code{repeat}
\item \code{switch}
\item logical operators (\code{&&}, \code{||}, \code{&}, \code{|})
\item function defaults and function bodies
}

For functions without srcref metadata, deparse-based fallback is disabled by
default. To allow fallback, set
\code{options(impuresrcref.allow_deparse_fallback = TRUE)}.
}
\examples{
options(keep.source = TRUE)
f <- eval(parse(text = "function(x, y) if (x && y) f() else g()", keep.source = TRUE)[[1]])
g <- impute_srcrefs(f)
g
}
